---
title: "Okta & Corbado Connect Passkey Integration"
description: "Integrate Okta with Corbado Connect for passkeys. Offer secure and convenient passkey authentication to all your Okta users."
sidebarTitle: "Okta"
---

import OktaDemo from "/snippets/corbado-connect/okta-demo.mdx"

<OktaDemo />

## 0. TODOS

- Check with Athena to address "real customer questions"
- DONE Link to Demo
- Small Video (no youtube)
- No code and no mermaids (TBD if some frontend code with componentns and high level mermaid with OIDC party is okay)
- DONE define okta version (they have multiple products)

## 1. Introduction

**Corbado Connect** allows you to seamlessly integrate passkey-first authentication into your existing **Okta** system. This enables you to offer your users a secure and convenient login experience without passwords, while still leveraging the power of **Okta** for user management.

This guide will walk you through the process of integrating **Corbado Connect** with **Okta**, using a sample Next.js application to demonstrate the key concepts.

**Okta** offers multiple authentication solutions that have evolved over time. **Corbado Connect** supports the following:

- **Okta Identity Engine** (requires custom domain and hosted widget)
- **Okta CIC/Auth0** (Auth0 was acquired by **Okta** and is now part of **Okta CIC**)

**Okta Classic** is currently **not supported**. If you need more information about the different **Okta** solutions, read our [blog article](https://www.corbado.com/blog/okta-passkeys-analysis) or [contact us](TODO).

## 2. How it Works

The integration between **Corbado Connect** and **Okta** leverages the industry-standard **OAuth 2.0 Authorization Framework** and **OpenID Connect (OIDC)** protocol. This approach allows **Corbado Connect** to act as an external **Identity Provider (IdP)** that seamlessly integrates with your existing **Okta** infrastructure.

Instead of users authenticating directly with **Okta** using traditional credentials, they will authenticate with **Corbado Connect** using passkeys, and then be federated back to **Okta** through a secure OIDC flow.

This **OAuth 2.0/OIDC federation** approach ensures that your existing **Okta** policies, user management, and application integrations remain unchanged while adding the security and convenience of passkey-first authentication.

Later in this guide, we will dive deep into this concept.

## 3. Example Application

To best illustrate the integration, we will refer to a complete example application. This application is built with the following technologies:

- **Next.js**: A popular React framework for building server-rendered applications.

We will guide you through the implementation of two primary user flows: sign-up and login.

<Card title="Example Application" href="https://okta-ek30212.cloud.corbado-demo.com">
See the example application using Corbado Connect and Okta in action.
</Card>

## 4. Passkey Enrollment

In our example application, the initial user sign-up is handled through a conventional method (e.g., email and password) managed by **Okta**. Once the user has an account and is logged in, we offer them the option to add a passkey to their account for future passwordless logins. This process is often called "passkey append".

The complete flow is illustrated in detail [here](/corbado-connect/flows/user-sign-up).

### 4.1 Web UI Component Integration

To enable passkey creation we use the [CorbadoConnectAppend](/corbado-connect/web-ui-components/corbadoconnectappend) component from the `@corbado/connect-react` library. The component takes care of the entire UI and logic for creating and storing the passkey.

Here's how it's used in our example application's `post-login` page:

```tsx /application/okta/app/(auth-required)/post-login/page.tsx
"use client";

import {CorbadoConnectAppend} from "@corbado/connect-react";
import {useRouter} from "next/navigation";
import {getCorbadoConnectTokenAppend, postPasskeyAppend} from "./actions";
import {AppendStatus} from "@corbado/types";

export default function Page() {
    const router = useRouter();

    return (
        <div className="flex h-screen flex-1 items-center justify-center bg-gray-50">
            <div className="z-10 w-full max-w-sm overflow-hidden rounded-2xl border border-gray-100 shadow-xl">
                <div className="flex flex-col space-y-4 bg-gray-50 px-4 py-8 sm:px-8">
                    <CorbadoConnectAppend
                        onSkip={async () => router.push("/profile")}
                        appendTokenProvider={async () => {
                            return await getCorbadoConnectTokenAppend();
                        }}
                        onComplete={async (
                            appendStatus: AppendStatus,
                            clientState: string
                        ) => {
                            await postPasskeyAppend(appendStatus, clientState);
                            router.push("/profile");
                        }}
                    />
                </div>
            </div>
        </div>
    );
}
```

<Info>
For a detailed explanation of all available props for this component, please see the [CorbadoConnectAppend](/corbado-connect/web-ui-components/corbadoconnectappend) component documentation.
</Info>

### 4.2 Obtaining the Connect Token

When the component is initialized, it executes the function given in `appendTokenProvider` to request a [connect token](/corbado-connect/concepts/connect-token) from Corbado's Backend API (this token authorizes the creation of a passkey for a specific and authenticated user).

It uses a Next.js Server Action that first verifies the session and then calls the utility function `getCorbadoConnectToken()`:

```typescript /application/okta/app/(auth-required)/post-login/actions.ts
'use server';

import {AppendStatus} from "@corbado/types";
import {cookies} from "next/headers";
import {getCorbadoConnectToken} from "@/lib/corbado";
import {auth} from "@/auth";


export async function getCorbadoConnectTokenAppend() {
    const session = await auth();
    if (!session) {
        throw new Error('Session is required');
    }

    const displayName = session.user.email;
    const identifier = session.user.userId;

    return getCorbadoConnectToken('passkey-append', displayName, identifier);
}
```

The utility function subsequently manages the request to the Corbado Backend API:

```typescript
export const getCorbadoConnectToken = async (connectTokenType: string, displayName: string, identifier: string): Promise<string> => {
  const payload = {
    type: connectTokenType,
    data: {
      displayName: displayName,
      identifier: identifier,
    },
  };

  const body = JSON.stringify(payload);

  const url = `${process.env.CORBADO_BACKEND_API_URL}/v2/connectTokens`;
  const response = await fetch(url, {
    method: 'POST',
    headers: {
      Authorization: `Basic ${process.env.CORBADO_BACKEND_API_BASIC_AUTH}`,
      'Content-Type': 'application/json',
    },
    cache: 'no-cache',
    body: body,
  });

  const out = await response.json();

  return out.secret;
}
```

## 5. Passkey Login

Now that users can associate passkeys with their accounts, we can enable a truly passwordless login experience. This is where the **OAuth 2.0/OIDC federation**  we outlined in the "How it Works" section becomes essential.

The goal is to authenticate a user with their passkey using **Corbado Connect** and, upon success, establish an authenticated session with **Okta**.

The complete flow is illustrated in detail [here](/corbado-connect/flows/user-login).

### 5.1 Web UI Component Integration

Unlike passkey enrollment, the login process is more complex because we need to integrate the [CorbadoConnectLogin](/corbado-connect/web-ui-components/corbadoconnectlogin) component directly into **Okta's** hosted sign-in page (hosted widget).

This integration is accomplished through the **Okta** Admin Console under **Customizations > Brands**:

```html
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex,nofollow" />
    <!-- Styles generated from theme -->
    <link href="{{themedStylesUrl}}" rel="stylesheet" type="text/css">
    <!-- Favicon from theme -->
    <link rel="shortcut icon" href="{{faviconUrl}}" type="image/x-icon"/>

    <script src="https://cdn.cloud.corbado.io/connect/dist/web-js-latest.min.js"></script>
    <link rel="stylesheet" href="https://cdn.cloud.corbado.io/connect/dist/web-js-latest.min.css" />

    <title>{{pageTitle}}</title>
    {{{SignInWidgetResources}}}

    <style nonce="{{nonceValue}}">
        {{#useSiwGen3}}
        html {
            font-size: 87.5%;
        }
        {{/useSiwGen3}}

        #login-bg-image-id {
            background-image: {{bgImageUrl}}
        }
    </style>

    <style>
        .cb-connect-custom-style {
            --cb-color-outline: #dcdcdc;
            --cb-color-primary: #253544;
            --cb-color-secondary: #929aa1;
            --cb-color-tertiary: #666;
            --cb-color-on-primary: #fff;
            --cb-border-radius: 5px;
            --cb-color-surface: var(--color-gray-50);
            --cb-color-primary-container: #eef2f3;
            --cb-color-on-primary-container: #253544;
            --cb-color-secondary-container: #ecf4e7;
            --cb-color-on-secondary-container: #80b816;
            --cb-font-family-primary: var(
                    --default-font-family,
                    ui-sans-serif,
                    system-ui,
                    sans-serif,
                    "Apple Color Emoji",
                    "Segoe UI Emoji",
                    "Segoe UI Symbol",
                    "Noto Color Emoji"
            );
            --cb-font-family-secondary: var(
                    --default-font-family,
                    ui-sans-serif,
                    system-ui,
                    sans-serif,
                    "Apple Color Emoji",
                    "Segoe UI Emoji",
                    "Segoe UI Symbol",
                    "Noto Color Emoji"
            );

            --cb-color-error-container: #ffd6da;
            --cb-color-on-error-container: #cf0000;
        }

        #passkey-login-container {
            .cb-connect-login {
                max-width: 400px;
                container-type: inline-size;
            }

            .cb-login-hybrid-container {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .cb-login-hybrid-container .cb-p,
            .cb-login-hybrid-container .cb-link-button {
                text-align: center;
            }

            .cb-login-init-signup {
                margin-top: 2rem;
            }

            .cb-login-header {
                text-align: center;
            }

            .cb-login-error-soft-icons,
            .cb-login-error-hard-icons {
                margin: 1.5rem 0;
                display: flex;
                justify-content: center;
            }

            .cb-login-error-soft-text,
            .cb-login-error-hard-text {
                margin: 1rem 0;
                text-align: center;
            }

            .cb-login-error-soft-fallback {
                margin-top: 1rem;
                text-align: center;
                color: var(--cb-color-secondary);
            }

            .cb-login-error-soft-button,
            .cb-login-error-hard-button {
                width: 100%;
                background: var(--cb-color-primary);
            }

            .cb-login-error-hard-icons > * {
                width: 80px;
            }

            .cb-login-error-hard-fallback {
                margin-top: 1rem;
                width: 100%;
            }

            .cb-login-error-hard-button-help {
                color: var(--cb-color-secondary);
            }

            .cb-switch {
                margin-top: 1rem;
            }

            .cb-login-hybrid-icons {
                margin: 1rem 0;
                padding: 2rem 0;
                display: flex;
                justify-content: center;
                color: var(--cb-color-on-primary-container);
                border-radius: var(--cb-border-radius);
            }

            .cb-login-hybrid-icons {
                gap: 2rem;
            }

            .cb-login-hybrid-icons > * {
                width: 180px;
            }

            .cb-login-hybrid-cta {
                margin: 1rem 0rem;
                display: flex;
                flex-direction: column;
                gap: 1rem;
                width: 100%;
            }

            .cb-login-loader-container {
                width: 100%;
                display: flex;
                justify-content: center;
                padding-top: 1rem;
                padding-bottom: 1rem;
            }

            .cb-login-loader {
                width: 50px;
                height: 50px;
            }

            .cb-passkey-button {
                padding: 1rem;
                background-color: white;
                color: var(--cb-color-on-primary);
                border-radius: var(--cb-border-radius);
                border: 1px solid var(--cb-color-outline);
                font-family: var(--cb-font-family-primary);
                width: 100%;
                display: flex;
                justify-items: between;
                align-items: center;
                gap: 1rem;
            }

            .cb-passkey-button-icon {
                width: 25px;
                height: 25px;
                color: black;
            }

            .cb-passkey-button-content {
                flex: 1;
                text-align: left;
            }

            .cb-passkey-button-title {
                font-weight: bold;
                font-size: 0.8rem;
                color: black;
            }

            .cb-passkey-button-subtitle {
                color: var(--cb-color-primary);
                font-size: 0.8rem;
            }

            .cb-passkey-button-arrow {
                width: 9px;
                color: black;
            }

            .cb-h2 {
                font-family: var(--cb-font-family-primary);
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
            }

            .cb-h3 {
                font-family: var(--cb-font-family-primary);
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }

            .cb-p {
                font-family: var(--cb-font-family-secondary);
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }

            .cb-divider {
                height: 1rem;
            }

            .cb-span {
                font-family: var(--cb-font-family-secondary);
                font-size: 1rem;
            }

            .cb-bold {
                font-weight: bold;
            }

            .cb-link-button {
                cursor: pointer;
                width: 100%;
                text-decoration: underline;
            }

            .cb-connect-container {
                font-family: var(--cb-font-family-primary);
                background-color: var(--cb-color-surface);
                display: flex;
                flex-direction: column;
                box-sizing: border-box;
                text-align: left;
                width: 100%;
            }

            button.cb-primary-button {
                padding: 0.75rem 1.5rem;
                color: var(--cb-color-on-primary);
                background-color: var(--cb-color-primary);
                border-radius: var(--cb-border-radius);
                border: none;
                cursor: pointer;
                box-sizing: border-box;
                font-family: var(--cb-font-family-primary);
                text-decoration: none;
            }

            .cb-primary-button:hover,
            .cb-primary-button:focus,
            .cb-primary-button:active {
                border: none;
                opacity: 92%;
            }

            .cb-primary-button:disabled {
                opacity: 84%;
            }

            button:hover {
                cursor: pointer;
            }

            button.cb-secondary-button {
                padding: 0.75rem 1.5rem;
                color: var(--cb-color-on-secondary);
                background-color: var(--cb-color-secondary);
                border-radius: var(--cb-border-radius);
                border: none;
                cursor: pointer;
                box-sizing: border-box;
                font-family: var(--cb-font-family-primary);
            }

            .cb-secondary-button:hover,
            .cb-secondary-button:focus,
            .cb-secondary-button:active {
                border: none;
                opacity: 92%;
            }

            button.cb-outline-button {
                padding: 0.75rem 1.5rem;
                color: var(--cb-color-primary);
                background-color: transparent;
                border-radius: var(--cb-border-radius);
                border: 1px solid var(--cb-color-primary);
                cursor: pointer;
                box-sizing: border-box;
                font-family: var(--cb-font-family-primary);
            }

            .cb-input {
                flex-grow: 1;
                border-radius: var(--cb-border-radius);
                color: var(--cb-color-tertiary);
                border: 1px solid var(--cb-color-outline);
                padding: 0.75rem 0.5rem;
                justify-content: center;
                box-sizing: border-box;
                font-family: var(--cb-font-family-secondary);
            }

            .cb-input:focus {
                outline: none;
                border: 1px solid var(--cb-color-primary);
            }

            .cb-input:disabled {
                background-color: var(--cb-input-disabled-color);
            }

            .cb-input-error {
                border: 1px solid var(--cb-color-error);
            }

            .cb-input-field {
                display: flex;
                flex-direction: column;
                justify-content: center;
                margin-bottom: 0.75rem;
            }

            .cb-checkbox-input-field {
                margin-bottom: 0.75rem;
            }

            .cb-checkbox-input-field input {
                margin-right: 0.5rem;
            }

            .cb-input-label {
                font-family: var(--cb-font-family-secondary);
                margin: 0.25rem 0.5rem;
            }

            .cb-input-label-text {
            }

            .cb-notification-container {
                display: flex;
                padding: 0.5rem 1rem;
                background: var(--cb-color-secondary-container);
                color: var(--cb-color-on-secondary-container);
                border-radius: 0.7rem;
            }

            .cb-notification-icon {
                width: 20px;
                margin-right: 0.25rem;
                fill: var(--cb-color-on-secondary-container);
            }

            .cb-notification-text {
                font-size: 0.8rem;
                display: flex;
                align-items: center;
            }

            .cb-error-notification {
                width: 100%;
                box-sizing: border-box;
                background-color: var(--cb-color-error-container);
                color: var(--cb-color-on-error-container);
                border-radius: var(--cb-border-radius);
                align-items: center;
                gap: 1rem;
                margin-bottom: 1rem;
            }

            .loader {
                width: 0.75rem;
                height: 0.75rem;
                border: 2px solid #fff;
                border-radius: 50%;
                display: inline-block;
                box-sizing: content-box;
                animation: rotation 1s linear infinite;
                vertical-align: middle;
            }

            .loader-primary {
                border-top-color: var(--cb-color-primary);
                border-bottom-color: transparent;
            }

            .loader-on-primary {
                border-color: var(--cb-color-on-primary);
                border-bottom-color: transparent;
            }

            .button-loading-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: inherit;
                border-radius: inherit;
                border: inherit;
            }

            @keyframes rotation {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }

            .cb-connect-custom-style div.cb-connect-append-cta {
                border-top: none;
            }

            .cb-connect-custom-style .cb-login-error-soft-container,
            .cb-connect-custom-style .cb-login-error-hard-container {
                align-items: normal;
                width: 100%;
            }

            .cb-connect-custom-style button.cb-login-hybrid-button {
                width: 100%;
            }

            .cb-connect-custom-style button.cb-login-error-soft-button,
            .cb-connect-custom-style button.cb-login-error-hard-button,
            .cb-connect-custom-style button.cb-login-error-hard-fallback {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="login-bg-image-id" class="login-bg-image tb--background"></div>
    <div id="okta-login-container"></div>

    <!--
        "OktaUtil" defines a global OktaUtil object
        that contains methods used to complete the Okta login flow.
     -->
    {{{OktaUtil}}}

    <script type="text/javascript" nonce="{{nonceValue}}">
        // "config" object contains default widget configuration
        // with any custom overrides defined in your admin settings.
        var config = OktaUtil.getSignInWidgetConfig();

        // Render the Okta Sign-In Widget
        var oktaSignIn = new OktaSignIn(config);
        oktaSignIn.renderEl({ el: '#okta-login-container' },
            OktaUtil.completeLogin,
            function(error) {
                // Logs errors that occur when configuring the widget.
                // Remove or replace this with your own custom error handler.
                console.log(error.message, error);
            }
        );
    </script>

    <script type="text/javascript">
        const oktaFFHandshake = async (signedPasskeyData) => {
            const config = OktaUtil.getSignInWidgetConfig();
            const stateHandle = config.stateToken;
            const url = document.querySelector('.okta-idps-container').children[0].href;
            window.location.href = `/sso/idps/0oatsgxte1zfxW3gI697?login_hint=${signedPasskeyData}&fromURI=` + encodeURIComponent(location.href)
        }

        const setConventionalLoginError = (errorMessage) => {
            const cboErrorContainerId = 'cbo-error-container';
            const existingContainer = document.querySelector('#' + cboErrorContainerId);
            console.log("existingContainer", existingContainer);
            if (existingContainer) {
                existingContainer.remove();
            }

            if (errorMessage === '') {
                return;
            }

            const newDiv1 = document.createElement('div');
            newDiv1.className = 'o-form-has-errors';
            newDiv1.id = cboErrorContainerId;
            newDiv1.role = 'alert';
            const newDiv2 = document.createElement('div');
            const newDiv3 = document.createElement('div');
            newDiv3.className = 'okta-form-infobox-error infobox infobox-error'
            newDiv3.role = 'alert';
            const newText = document.createElement('p');
            newText.textContent = errorMessage;
            newDiv3.appendChild(newText);
            newDiv2.appendChild(newDiv3);
            newDiv1.appendChild(newDiv2);

            var form = document.querySelector('.o-form-fieldset-container');
            form.parentNode.insertBefore(newDiv1, form);

            const submitButton = form.parentNode.parentNode.querySelector('input[type="submit"]');
            if (submitButton) {
                submitButton.addEventListener('click', function(event) {
                    setConventionalLoginError('');
                });
            }
        }

        const fallbackToConventionalLogin = (passkeyLoginElement, conventionalLoginElement, email) => {
            passkeyLoginElement.style.display = 'none';
            const usernameInput = Array.from(conventionalLoginElement.querySelectorAll('input')).find(el => el.name.trim() === 'identifier');
            usernameInput.value = email;
            usernameInput.dispatchEvent(new Event('input', { bubbles: true }));
            conventionalLoginElement.style.display = 'block';
        }

        const getOnCompletePasskeyLoginFunction = () => {
            return async (signedPasskeyData, clientState) => {
                oktaFFHandshake(signedPasskeyData);
            };
        }

        const mountLogin = (passkeyLoginElement, conventionalLoginElement) => {
            Corbado.mountCorbadoConnectLogin(passkeyLoginElement, {
                projectId: 'pro-8464273456666930151',
                frontendApiUrlSuffix: "frontendapi.cloud.corbado.io",
                customDomain: "https://corbado.okta-ek30212.cloud.corbado-demo.com",
                onFallback: (email, errorMessage) => {
                    setConventionalLoginError(errorMessage);
                    fallbackToConventionalLogin(passkeyLoginElement, conventionalLoginElement, email);
                },
                onFallbackSilent: (email) => {
                    fallbackToConventionalLogin(passkeyLoginElement, conventionalLoginElement, email);
                },
                onComplete: getOnCompletePasskeyLoginFunction(),
                onSignupClick: () => console.log(""),
                onConditionalLoginStart: (ac) => {
                    console.log("");
                }
            });
        }

        const handlePrimaryAuth = () => {
            // Section 1: Add passkey container
            const conventionalLoginElement = document.querySelector('.auth-content-inner');
            if (!conventionalLoginElement) {
                return;
            }

            const newDiv = document.createElement('div');
            newDiv.id = 'passkey-login-container';
            const passkeyLoginElement = conventionalLoginElement.insertAdjacentElement('afterend', newDiv);
            conventionalLoginElement.style.display = 'none';

            mountLogin(passkeyLoginElement, conventionalLoginElement);

            // Section 2: Remove OIDC button
            const signInWithOIDCContainer = document.querySelector('.sign-in-with-idp');
            signInWithOIDCContainer.style.display = 'none';
        }

        const okta = new OktaSignIn(OktaUtil.getSignInWidgetConfig());
        okta.on('afterRender', c => {
            console.log('after render', c)
            const controllerName = c.controller;
            switch (controllerName) {
                case 'primary-auth':
                    return handlePrimaryAuth();
            }
        });

        okta.on('afterError', ((c, e) => {
            setConventionalLoginError('');
        }));
    </script>
</body>
</html>
```

<Info>
For a detailed explanation of all available props for this component, please see the [CorbadoConnectLogin component documentation](/corbado-connect/web-ui-components/corbadoconnectlogin).
</Info>

### 5.2 OAuth 2.0/OIDC Federation

As explained above, **Corbado Connect** functions as an **OIDC** server and can be used for **OAuth 2.0/OIDC federation**. To enable this integration, you need to create a new **Identity Provider** in the **Okta** Admin Console under **Security > Identity Providers**.

The following simplified sequence diagram illustrates how the different components work together in the federation process:

```mermaid
sequenceDiagram
    autonumber
    participant ExampleApplication as Example<br />Application
    participant OktaSignIn as Okta<br />Sign-in page
    participant OktaOIDC as Okta<br />OIDC server
    participant CorbadoOIDC as Corbado<br />OIDC server

    ExampleApplication->>OktaSignIn: User navigates<br />to sign-in page
    OktaSignIn->>OktaSignIn: CorbadoConnectLogin component<br />handles login
    OktaSignIn->>OktaOIDC: Redirect initiated by<br />CorbadoConnectLogin component
    OktaOIDC->>CorbadoOIDC: Redirect
    CorbadoOIDC->>CorbadoOIDC: Corbado verifies login
    CorbadoOIDC->>OktaOIDC: Redirect with<br />authorization_code
    OktaOIDC->>+CorbadoOIDC: Requests tokens
    CorbadoOIDC-->>-OktaOIDC: Returns tokens
    OktaOIDC->>OktaOIDC: Verifies tokens
    OktaOIDC->>ExampleApplication: Redirect with<br />authorization_code
    ExampleApplication->>+OktaOIDC: Requests tokens
    OktaOIDC-->>-ExampleApplication: Returns tokens
    Note over ExampleApplication: User is logged in<br />with tokens/session
```

## 6. TODO Passkey Management TODO

After users have created their initial passkeys during sign-up and used them for login, they need a way to manage their existing passkeys. Passkey management encompasses three main operations:

1. Viewing existing passkeys
2. Creating additional passkeys
3. Deleting unused passkeys

All these operations follow a similar pattern: they require obtaining a [connect token](/corbado-connect/concepts/connect-token) for the [Corbado Web UI Component](/corbado-connect/web-ui-components/overview), which then handles the user interface and underlying functionality. In the following sections, we'll focus on the **passkey deletion process as an example**, since the other operations follow a similar pattern.

The complete flow is illustrated in detail [here](/corbado-connect/flows/passkey-management).

### 6.1 Implementation Overview

The passkey deletion process consists of a series of interactions between the example application (utilizing AWS Amplify), **Amazon Cognito**, and Corbado APIs. These interactions are best illustrated using a sequence diagram:

```mermaid
sequenceDiagram
    autonumber
    participant ExampleFrontend as Example<br />Frontend
    participant ExampleBackend as Example<br />Backend
    participant FAPI as Corbado<br />Frontend API
    participant BAPI as Corbado<br />Backend API

    Note over ExampleFrontend: CorbadoConnectPasskeyList component<br />initiates
    ExampleFrontend->>+ExampleBackend: Request Corbado connect token
    ExampleBackend->>ExampleBackend: Verify user session
    ExampleBackend->>+BAPI: POST /v2/connectTokens
    BAPI-->>-ExampleBackend: Return connect token
    ExampleBackend-->>-ExampleFrontend: Return connect token

    ExampleFrontend->>+FAPI: Request passkey deletion<br/>(uses connect token and passkey ID)
    Note over ExampleFrontend: CorbadoConnectPasskeyList component<br />handles passkey deletion
    FAPI-->>-ExampleFrontend: Return success
```

### 6.2 Web UI Component Integration

We integrate the [CorbadoConnectPasskeyList](/corbado-connect/web-ui-components/corbadoconnectpasskeylist) component from the `@corbado/connect-react` library. This component provides a complete user interface for managing passkeys, including viewing, adding, and deleting them.

Here's how it's used in our example application's profile page:

```tsx /application/cognito/app/(auth-required)/profile/PasskeySection.tsx
'use client';

import {fetchAuthSession} from "aws-amplify/auth";
import {getConnectToken} from "@/app/(auth-required)/profile/actions";
import {CorbadoConnectPasskeyList} from "@corbado/connect-react";

type Props = {
    integratePasskeys: boolean;
};

export const PasskeySection = ({integratePasskeys}: Props) => {
    if (!integratePasskeys) {
        return (
            <div className='mb-2 w-full'>
                <div>Passkeys have not been integrated into this application.</div>
                <div>To integrate with 3 clicks. Use the button on the upper right side of this page.</div>
            </div>
        )
    }

    return (
        <div className='mb-2 w-full'>
            <CorbadoConnectPasskeyList
                connectTokenProvider={async (connectTokenType: string) => {
                    const session = await fetchAuthSession();
                    const idToken = session.tokens?.idToken?.toString();

                    return await getConnectToken(connectTokenType, idToken);
                }}
            />
        </div>
    )
}
```

<Info>
For a detailed explanation of all available props for this component, please see the [CorbadoConnectPasskeyList](/corbado-connect/web-ui-components/corbadoconnectpasskeylist) component documentation.
</Info>

### 6.3 Obtaining the Connect Token

When the component needs to perform an operation (like deleting a passkey), it executes the function given in `connectTokenProvider` to request a [connect token](/corbado-connect/concepts/connect-token) from Corbado's Backend API. This token authorizes the specific operation for the authenticated user.

The frontend first gets the `idToken` for the currently logged-in user from AWS Amplify. This JWT proves the user's session with **Amazon Cognito**. The `idToken` is then sent to a Next.js Server Action:

```typescript
connectTokenProvider={async (connectTokenType: string) => {
    const session = await fetchAuthSession();
    const idToken = session.tokens?.idToken?.toString();

    return await getConnectToken(connectTokenType, idToken);
}}
```

The server action first verifies the `idToken` to ensure it's valid and extracts the user's identity, then requests the [connect token](/corbado-connect/concepts/connect-token) by calling the utility function `getCorbadoConnectToken()`:

```typescript /application/cognito/app/(auth-required)/profile/actions.tsx
'use server';

import {getCorbadoConnectToken, verifyAmplifyToken} from "@/lib/utils";

export const getConnectToken = async (connectTokenType: string, idToken?: string) => {
    if (!idToken) {
        throw new Error('idToken is required');
    }

    const {displayName, identifier} = await verifyAmplifyToken(idToken);

    return getCorbadoConnectToken(connectTokenType, displayName, identifier);
}
```

The utility function then manages the request to the Corbado Backend API, using the provided `connectTokenType` to specify which operation the token should authorize (in this case, it could be 'passkey-list', 'passkey-add', or 'passkey-delete').